# Hyperdash Liquidation Hunter - Pipeline Flowchart

## High-Level Data Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA PIPELINE OVERVIEW                            │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
    │   STEP 1     │     │   STEP 2     │     │   STEP 3     │
    │   Cohort     │────▶│   Position   │────▶│  Liquidation │
    │   Scraper    │     │   Scraper    │     │    Filter    │
    └──────────────┘     └──────────────┘     └──────────────┘
          │                    │                    │
          ▼                    ▼                    ▼
    cohort_data.csv     position_data.csv    filtered_*.csv
```

---

## Step 1: Cohort Scraper

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        COHORT SCRAPER (cohort.py)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐                                                   │
│   │ Hyperdash GraphQL   │                                                   │
│   │ api.hyperdash.com   │                                                   │
│   └──────────┬──────────┘                                                   │
│              │                                                              │
│              │ GetSizeCohort Query                                          │
│              ▼                                                              │
│   ┌─────────────────────────────────────────────────────┐                   │
│   │              COHORT PRIORITY ORDER                  │                   │
│   │  ┌─────────┐  ┌─────────────┐  ┌───────┐  ┌───────┐│                   │
│   │  │ kraken  │▶│ large_whale │▶│ whale │▶│ shark ││                   │
│   │  │  $5M+   │  │   $1M-$5M   │  │$250K- │  │$100K- ││                   │
│   │  │  ~65    │  │    ~256     │  │  1M   │  │ 250K  ││                   │
│   │  └─────────┘  └─────────────┘  │ ~280  │  │~1559  ││                   │
│   │                                 └───────┘  └───────┘│                   │
│   └─────────────────────────────────────────────────────┘                   │
│              │                                                              │
│              │ Paginated (500/page, 1.0s delay)                             │
│              ▼                                                              │
│   ┌─────────────────────┐                                                   │
│   │ data/raw/           │                                                   │
│   │ cohort_data*.csv    │                                                   │
│   └─────────────────────┘                                                   │
│                                                                             │
│   Output columns:                                                           │
│   Address, Perp Equity, Perp Bias, Position Value,                          │
│   Leverage, Sum UPNL, PNL Cohort, Cohort                                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Step 2: Position Scraper

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       POSITION SCRAPER (position.py)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐     ┌─────────────────────────────────────────┐   │
│   │ cohort_data.csv     │     │         Hyperliquid API                 │   │
│   │ (wallet addresses)  │────▶│    api.hyperliquid.xyz/info             │   │
│   └─────────────────────┘     └─────────────────────────────────────────┘   │
│                                              │                              │
│                                              │ clearinghouseState           │
│                                              ▼                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                    EXCHANGE SCANNING                                │   │
│   │                                                                     │   │
│   │   For each wallet address:                                          │   │
│   │   ┌───────────────────────────────────────────────────────────────┐ │   │
│   │   │  ┌──────┐  ┌─────┐  ┌─────┐  ┌──────┐  ┌────┐               │ │   │
│   │   │  │ main │  │ xyz │  │ flx │  │ hyna │  │ km │               │ │   │
│   │   │  │      │  │     │  │     │  │      │  │    │               │ │   │
│   │   │  │Cross/│  │ All │  │ All │  │ All  │  │All │               │ │   │
│   │   │  │Isol. │  │Isol.│  │Isol.│  │Isol. │  │Iso.│               │ │   │
│   │   │  └──────┘  └─────┘  └─────┘  └──────┘  └────┘               │ │   │
│   │   │  Note: vntl excluded (no external price discovery)          │ │   │
│   │   └───────────────────────────────────────────────────────────────┘ │   │
│   │                                                                     │   │
│   │   Rate limiting:                                                    │   │
│   │   • REQUEST_DELAY = 0.2s between calls                              │   │
│   │   • BATCH_DELAY = 2.0s every 50 addresses                           │   │
│   │   • DEX_DELAY = 0.1s between dex queries                            │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                              │                              │
│                                              ▼                              │
│   ┌─────────────────────┐                                                   │
│   │ data/raw/           │                                                   │
│   │ position_data*.csv  │                                                   │
│   └─────────────────────┘                                                   │
│                                                                             │
│   Output columns:                                                           │
│   Address, Token, Side, Size, Leverage, Leverage Type, Entry Price,         │
│   Mark Price, Position Value, Unrealized PnL, ROE, Liquidation Price,       │
│   Margin Used, Funding (Since Open), Cohort, Exchange, Isolated             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Step 3: Liquidation Filter

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     LIQUIDATION FILTER (liquidation.py)                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────┐                                                   │
│   │ position_data.csv   │                                                   │
│   └──────────┬──────────┘                                                   │
│              │                                                              │
│              ▼                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     FILTER POSITIONS                                │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────┐                           │   │
│   │   │ Remove positions without            │                           │   │
│   │   │ liquidation price (can't hunt)      │                           │   │
│   │   └─────────────────────────────────────┘                           │   │
│   │                       │                                             │   │
│   └───────────────────────┼─────────────────────────────────────────────┘   │
│                           ▼                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   FETCH MARKET DATA                                 │   │
│   │                                                                     │   │
│   │   ┌───────────────────┐     ┌───────────────────┐                   │   │
│   │   │ allMids API       │     │ l2Book API        │                   │   │
│   │   │ (mark prices)     │     │ (order books)     │                   │   │
│   │   │                   │     │                   │                   │   │
│   │   │ 1 call per dex    │     │ 1 call per token  │                   │   │
│   │   └───────────────────┘     │ 0.1s delay        │                   │   │
│   │                             └───────────────────┘                   │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                           │                                                 │
│                           ▼                                                 │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                  CALCULATE METRICS                                  │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │  Distance to Liq (%)                                        │   │   │
│   │   │  = (current - liq) / current * 100  [for longs]             │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │  Estimated Liquidatable Value                               │   │   │
│   │   │  = 100% of notional (isolated)                              │   │   │
│   │   │  = 20% of notional (cross)                                  │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │  Notional to Trigger                                        │   │   │
│   │   │  = Sum liquidity between current and liq price              │   │   │
│   │   │  (walk order book)                                          │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │  Est Price Impact (%)                                       │   │   │
│   │   │  = Slippage from forced market order                        │   │   │
│   │   │  (simulate liquidation on order book)                       │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │  Hunting Score                                              │   │   │
│   │   │  = (Est Liq Value * Est Price Impact %)                     │   │   │
│   │   │    / (Notional to Trigger * Distance %^2)                   │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                           │                                                 │
│                           ▼                                                 │
│   ┌─────────────────────┐                                                   │
│   │ data/processed/     │                                                   │
│   │ filtered_*.csv      │                                                   │
│   └─────────────────────┘                                                   │
│                                                                             │
│   Added columns:                                                            │
│   Current Price, Distance to Liq (%), Estimated Liquidatable Value,         │
│   Notional to Trigger, Est Price Impact (%), Hunting Score                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Monitor Service

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        MONITOR SERVICE (service.py)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     SCHEDULED MODE (Default)                        │   │
│   │                                                                     │   │
│   │   ┌───────────────────────────────────────────────────────────┐     │   │
│   │   │  6:30 AM EST                                              │     │   │
│   │   │  ┌─────────────────────────────────────────────────────┐  │     │   │
│   │   │  │ COMPREHENSIVE SCAN (Baseline)                       │  │     │   │
│   │   │  │ • All cohorts (kraken → shark)                      │  │     │   │
│   │   │  │ • All 6 exchanges                                   │  │     │   │
│   │   │  │ • Full watchlist reset                              │  │     │   │
│   │   │  └─────────────────────────────────────────────────────┘  │     │   │
│   │   └───────────────────────────────────────────────────────────┘     │   │
│   │                              │                                      │   │
│   │                              ▼                                      │   │
│   │   ┌───────────────────────────────────────────────────────────┐     │   │
│   │   │  Every :00 (hourly)                                       │     │   │
│   │   │  ┌─────────────────────────────────────────────────────┐  │     │   │
│   │   │  │ NORMAL SCAN                                         │  │     │   │
│   │   │  │ • kraken, large_whale, whale                        │  │     │   │
│   │   │  │ • main + xyz exchanges                              │  │     │   │
│   │   │  │ • Alert only NEW positions                          │  │     │   │
│   │   │  └─────────────────────────────────────────────────────┘  │     │   │
│   │   └───────────────────────────────────────────────────────────┘     │   │
│   │                              │                                      │   │
│   │                              ▼                                      │   │
│   │   ┌───────────────────────────────────────────────────────────┐     │   │
│   │   │  Every :30 (half-hour)                                    │     │   │
│   │   │  ┌─────────────────────────────────────────────────────┐  │     │   │
│   │   │  │ HIGH-PRIORITY SCAN                                  │  │     │   │
│   │   │  │ • kraken, large_whale only                          │  │     │   │
│   │   │  │ • main + xyz exchanges                              │  │     │   │
│   │   │  │ • Fast scan, alert only NEW positions               │  │     │   │
│   │   │  └─────────────────────────────────────────────────────┘  │     │   │
│   │   └───────────────────────────────────────────────────────────┘     │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│                              │                                              │
│                              ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      SCAN PHASE                                     │   │
│   │                                                                     │   │
│   │   ┌────────────┐    ┌────────────┐    ┌────────────┐               │   │
│   │   │  1. Cohort │───▶│ 2. Position│───▶│ 3. Filter  │               │   │
│   │   │   Scraper  │    │   Scraper  │    │            │               │   │
│   │   └────────────┘    └────────────┘    └────────────┘               │   │
│   │                                              │                      │   │
│   │                                              ▼                      │   │
│   │                           ┌─────────────────────────────────┐       │   │
│   │                           │  4. Compare with BASELINE       │       │   │
│   │                           │     • Find NEW positions        │       │   │
│   │                           │     • Check alert thresholds    │       │   │
│   │                           └─────────────────────────────────┘       │   │
│   │                                              │                      │   │
│   │                                              ▼                      │   │
│   │                           ┌─────────────────────────────────┐       │   │
│   │                           │  5. Send NEW POSITION ALERTS    │       │   │
│   │                           │     (Telegram)                  │       │   │
│   │                           └─────────────────────────────────┘       │   │
│   │                                              │                      │   │
│   │                                              ▼                      │   │
│   │                           ┌─────────────────────────────────┐       │   │
│   │                           │  6. Update watchlist            │       │   │
│   │                           │     • Baseline: replace         │       │   │
│   │                           │     • Non-baseline: merge       │       │   │
│   │                           └─────────────────────────────────┘       │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│                              │                                              │
│                              ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     MONITOR PHASE                                   │   │
│   │                  (runs until next scan)                             │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────────────┐   │   │
│   │   │              Every 5 seconds:                               │   │   │
│   │   │                                                             │   │   │
│   │   │   ┌─────────────────────────────────────────────────────┐   │   │   │
│   │   │   │  1. Fetch all mark prices (allMids - 1 API call)    │   │   │   │
│   │   │   └─────────────────────────────────────────────────────┘   │   │   │
│   │   │                          │                                  │   │   │
│   │   │                          ▼                                  │   │   │
│   │   │   ┌─────────────────────────────────────────────────────┐   │   │   │
│   │   │   │  2. For each watched position:                      │   │   │   │
│   │   │   │     • Recalculate distance to liquidation           │   │   │   │
│   │   │   │     • Check against threshold                       │   │   │   │
│   │   │   └─────────────────────────────────────────────────────┘   │   │   │
│   │   │                          │                                  │   │   │
│   │   │                          ▼                                  │   │   │
│   │   │   ┌─────────────────────────────────────────────────────┐   │   │   │
│   │   │   │  3. If distance < threshold:                        │   │   │   │
│   │   │   │     → Send PROXIMITY ALERT (if not already sent)    │   │   │   │
│   │   │   └─────────────────────────────────────────────────────┘   │   │   │
│   │   │                                                             │   │   │
│   │   └─────────────────────────────────────────────────────────────┘   │   │
│   │                                                                     │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Alert Thresholds

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ALERT THRESHOLDS                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  TIER 1 (Major Assets)                                              │   │
│   │  Assets: BTC, ETH, SOL, BNB                                         │   │
│   │  Min Position: $50M                                                 │   │
│   │  Alert Distance: 3%                                                 │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  TIER 2 (Secondary Assets)                                          │   │
│   │  Assets: XRP, DOGE, ADA, AVAX, LINK, LTC                            │   │
│   │  Min Position: $20M                                                 │   │
│   │  Alert Distance: 3%                                                 │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  ALTS (All Other Assets)                                            │   │
│   │  Min Position: $5M                                                  │   │
│   │  Alert Distance: 3%                                                 │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │  DEFAULT (Fallback)                                                 │   │
│   │  Any position size                                                  │   │
│   │  Alert Distance: 1%                                                 │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Scan Modes

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            SCAN MODES                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────┬──────────────────────────┬──────────────────────────┐   │
│  │     Mode       │        Cohorts           │       Exchanges          │   │
│  ├────────────────┼──────────────────────────┼──────────────────────────┤   │
│  │ high-priority  │ kraken, large_whale      │ main, xyz                │   │
│  │                │ (~321 addresses)         │ (2 exchanges)            │   │
│  ├────────────────┼──────────────────────────┼──────────────────────────┤   │
│  │ normal         │ kraken, large_whale,     │ main, xyz                │   │
│  │                │ whale (~601 addresses)   │ (2 exchanges)            │   │
│  ├────────────────┼──────────────────────────┼──────────────────────────┤   │
│  │ comprehensive  │ all cohorts including    │ all 5 exchanges          │   │
│  │                │ shark (~2160 addresses)  │ (main,xyz,flx,hyna,km)   │   │
│  │                │                          │                          │   │
│  └────────────────┴──────────────────────────┴──────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Summary

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         END-TO-END DATA FLOW                                │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────────────┐
                    │     EXTERNAL APIs         │
                    │                           │
                    │  ┌─────────────────────┐  │
                    │  │ Hyperdash GraphQL   │  │
                    │  │ (wallet addresses)  │  │
                    │  └──────────┬──────────┘  │
                    │             │             │
                    │  ┌──────────▼──────────┐  │
                    │  │ Hyperliquid API     │  │
                    │  │ • clearinghouseState│  │
                    │  │ • allMids           │  │
                    │  │ • l2Book            │  │
                    │  └──────────┬──────────┘  │
                    └─────────────┼─────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         PROCESSING                                          │
│                                                                             │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐                │
│  │   Cohort     │────▶│   Position   │────▶│  Liquidation │                │
│  │   Scraper    │     │   Scraper    │     │    Filter    │                │
│  └──────────────┘     └──────────────┘     └──────────────┘                │
│        │                    │                    │                          │
│        ▼                    ▼                    ▼                          │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐                │
│  │cohort_data   │     │position_data │     │filtered_     │                │
│  │*.csv         │     │*.csv         │     │position_data │                │
│  │              │     │              │     │*.csv         │                │
│  └──────────────┘     └──────────────┘     └──────────────┘                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                       MONITOR SERVICE                                       │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      WATCHLIST                                      │   │
│  │  Positions within MAX_WATCH_DISTANCE_PCT (15%) of liquidation       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                 CONTINUOUS MONITORING                               │   │
│  │              (poll mark prices every 5 sec)                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                              │                                              │
│                              ▼                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      ALERTS                                         │   │
│  │  • New Position Alerts (scan phase)                                 │   │
│  │  • Proximity Alerts (monitor phase)                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
                    ┌───────────────────────────┐
                    │     TELEGRAM BOT          │
                    │  (Real-time notifications)│
                    └───────────────────────────┘
```
